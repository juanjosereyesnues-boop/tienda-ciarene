<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ciarené - Shop</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root { --p: #ff4d6d; --d: #2d3436; --bg: #fdfcfb; }
        body { font-family: 'Poppins'; margin: 0; background: var(--bg); }
        .header { background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        .cat-bar { display: flex; gap: 10px; overflow-x: auto; padding: 15px 5%; scrollbar-width: none; }
        .cat-btn { padding: 10px 25px; border-radius: 50px; border: 1px solid #eee; background: white; cursor: pointer; transition: 0.3s; white-space: nowrap; }
        .cat-btn.active { background: var(--d); color: white; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 25px; padding: 20px 5%; }
        .card { background: white; border-radius: 30px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.05); transition: 0.4s; cursor: pointer; position: relative; }
        .card:hover { transform: translateY(-10px) rotate(1deg); box-shadow: 0 20px 40px rgba(255,77,109,0.15); }
        .card img { width: 100%; height: 350px; object-fit: cover; }
        .card-info { padding: 20px; text-align: center; }
        .btn-plus { position: absolute; bottom: 15px; right: 15px; background: var(--p); color: white; border: none; width: 45px; height: 45px; border-radius: 50%; font-size: 1.5rem; }

        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); }
        .m-content { background: white; margin: 5% auto; width: 90%; max-width: 400px; border-radius: 35px; overflow: hidden; animation: zoomIn 0.3s; position: relative; }
        .m-body { padding: 25px; }
        .btn-add { width: 100%; padding: 18px; background: var(--p); color: white; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <header class="header">
        <h1 style="color:var(--p); margin:0">Ciarené</h1>
        <a href="/carrito" style="text-decoration:none; color:var(--d); font-size:1.5rem">
            <i class="fas fa-shopping-bag"></i> <span id="count" style="font-size:1rem; background:var(--p); color:white; padding:2px 8px; border-radius:50%">0</span>
        </a>
    </header>

    <div class="cat-bar">
        <button class="cat-btn active" onclick="filtrar('Todos')">Todo ✨</button>
        <button class="cat-btn" onclick="filtrar('Pijamas')">Pijamas</button>
        <button class="cat-btn" onclick="filtrar('Deportivo')">Deportivo</button>
        <button class="cat-btn" onclick="filtrar('Pantalones')">Pantalones</button>
    </div>

    <div class="grid" id="productos"></div>

    <div id="modal-p" class="modal">
        <div class="m-content">
            <span onclick="cerrar()" style="position:absolute; top:20px; right:20px; color:white; font-size:2rem; cursor:pointer">&times;</span>
            <img id="m-img" style="width:100%; height:300px; object-fit:cover">
            <div class="m-body">
                <h2 id="m-nom" style="margin:0"></h2>
                <p id="m-pre" style="color:var(--p); font-size:1.5rem; font-weight:bold"></p>
                <select id="m-talla" style="width:100%; padding:10px; margin:10px 0; border-radius:10px;"></select>
                <select id="m-color" style="width:100%; padding:10px; margin-bottom:20px; border-radius:10px;"></select>
                <button class="btn-add" onclick="añadir()">Añadir al Carrito ✨</button>
            </div>
        </div>
    </div>

    <script>
        if(!localStorage.getItem('u_ciarene')) window.location.href='/';
        let prodGlobal = [];
        let carrito = JSON.parse(localStorage.getItem('carrito_ciarene')) || [];
        let pSel = null;

        async function cargar() {
            const r = await fetch('/api/productos');
            const d = await r.json();
            prodGlobal = d.data;
            render(prodGlobal);
            document.getElementById('count').innerText = carrito.length;
        }

        function render(lista) {
            const cont = document.getElementById('productos');
            cont.innerHTML = '';
            lista.forEach((p, i) => {
                const div = document.createElement('div');
                div.className = 'card animate__animated animate__fadeInUp';
                div.style.animationDelay = `${i*0.1}s`;
                div.onclick = () => abrir(p);
                div.innerHTML = `<img src="${p.imagen}"><div class="card-info"><h3>${p.nombre}</h3><b style="color:var(--p)">$${p.precio.toLocaleString()}</b></div><button class="btn-plus">+</button>`;
                cont.appendChild(div);
            });
        }

        function filtrar(c) {
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            render(c === 'Todos' ? prodGlobal : prodGlobal.filter(p => p.categoria === c));
        }

        function abrir(p) {
            pSel = p;
            document.getElementById('m-img').src = p.imagen;
            document.getElementById('m-nom').innerText = p.nombre;
            document.getElementById('m-pre').innerText = `$${p.precio.toLocaleString()}`;
            document.getElementById('m-talla').innerHTML = p.tallas.map(t=>`<option>${t}</option>`).join('');
            document.getElementById('m-color').innerHTML = p.colores.map(c=>`<option>${c}</option>`).join('');
            document.getElementById('modal-p').style.display = 'block';
        }

        function cerrar() { document.getElementById('modal-p').style.display = 'none'; }

        function añadir() {
            const t = document.getElementById('m-talla').value;
            const c = document.getElementById('m-color').value;
            carrito.push({ nombre: `${pSel.nombre} (${t}, ${c})`, precio: pSel.precio });
            localStorage.setItem('carrito_ciarene', JSON.stringify(carrito));
            document.getElementById('count').innerText = carrito.length;
            cerrar();
        }
        window.onload = cargar;
    </script>
</body>
</html>
