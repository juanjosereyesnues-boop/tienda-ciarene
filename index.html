<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>CiarenÃ© - Moda Femenina</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root { --primary: #ff4d6d; --dark: #2d3436; --light: #f9f9f9; }
        body { font-family: 'Poppins', sans-serif; background: var(--light); margin: 0; }
        .header { background: white; padding: 20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        #productos { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; padding: 20px; }
        .card { background: white; border-radius: 15px; overflow: hidden; cursor: pointer; transition: 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .card:hover { transform: translateY(-5px); }
        .card img { width: 100%; height: 350px; object-fit: cover; }
        .card-info { padding: 15px; text-align: center; }
        .precio-actual { color: var(--primary); font-weight: bold; font-size: 1.2rem; }
        .precio-viejo { text-decoration: line-through; color: #aaa; margin-right: 10px; }
        .btn-add { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 50px; cursor: pointer; margin-top: 10px; width: 100%; }
        
        /* ESTILOS MODAL */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .modal-content { background: white; margin: 5% auto; width: 90%; max-width: 450px; border-radius: 20px; overflow: hidden; animation: zoomIn 0.3s; }
        .modal-info { padding: 25px; }
        .form-select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #ddd; }
        .close-modal { float: right; font-size: 25px; cursor: pointer; padding: 10px; }
        .cart-badge { background: var(--primary); color: white; padding: 2px 8px; border-radius: 50%; font-size: 0.8rem; position: absolute; }
    </style>
</head>
<body>

    <div class="header">
        <h1>CiarenÃ© ðŸ‘—</h1>
        <a href="carrito.html" style="text-decoration: none; color: var(--dark);">
            <i class="fas fa-shopping-cart"></i> Carrito <span id="cart-count" class="cart-badge">0</span>
        </a>
    </div>

    <div id="productos"></div>

    <div id="modal-producto" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="cerrarModal()">&times;</span>
            <img id="modal-imagen" src="" style="width: 100%; height: 300px; object-fit: cover;">
            <div class="modal-info">
                <h2 id="modal-nombre" style="margin: 0;"></h2>
                <p id="modal-descripcion" style="color: #666; font-size: 0.9rem; margin: 10px 0;"></p>
                <p id="modal-precio" class="precio-actual"></p>
                
                <label>Elegir Talla:</label>
                <select id="modal-talla" class="form-select"></select>

                <label>Elegir Color:</label>
                <select id="modal-color" class="form-select"></select>

                <button class="btn-add" onclick="aÃ±adirDesdeModal()" style="font-size: 1.1rem; padding: 15px;">
                    AÃ±adir al Pedido
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = "https://ciarene.up.railway.app/api/productos";
        let carrito = JSON.parse(localStorage.getItem('carrito_ciarene')) || [];
        let productoSeleccionado = null;

        async function cargarProductos() {
            try {
                const res = await fetch(API_URL);
                const json = await res.json();
                const container = document.getElementById('productos');
                container.innerHTML = '';

                json.data.forEach((p, i) => {
                    const pString = JSON.stringify(p).replace(/"/g, '&quot;');
                    container.innerHTML += `
                        <div class="card animate__animated fadeInUp" onclick="abrirModal(${pString})">
                            <img src="${p.imagen}">
                            <div class="card-info">
                                <h3>${p.nombre}</h3>
                                <span class="precio-actual">$${p.precio.toLocaleString()}</span>
                                <button class="btn-add">Ver Detalles</button>
                            </div>
                        </div>`;
                });
                actualizarContador();
            } catch (e) { container.innerHTML = "Error al cargar productos."; }
        }

        function abrirModal(p) {
            productoSeleccionado = p;
            document.getElementById('modal-imagen').src = p.imagen;
            document.getElementById('modal-nombre').innerText = p.nombre;
            document.getElementById('modal-descripcion').innerText = p.descripcion;
            document.getElementById('modal-precio').innerText = `$${p.precio.toLocaleString()}`;
            
            const selectTalla = document.getElementById('modal-talla');
            selectTalla.innerHTML = p.tallas.map(t => `<option value="${t}">${t}</option>`).join('');
            
            const selectColor = document.getElementById('modal-color');
            selectColor.innerHTML = p.colores.map(c => `<option value="${c}">${c}</option>`).join('');

            document.getElementById('modal-producto').style.display = "block";
        }

        function cerrarModal() { document.getElementById('modal-producto').style.display = "none"; }

        function aÃ±adirDesdeModal() {
            const talla = document.getElementById('modal-talla').value;
            const color = document.getElementById('modal-color').value;
            const nombreCompleto = `${productoSeleccionado.nombre} (Talla: ${talla}, Color: ${color})`;
            
            carrito.push({ nombre: nombreCompleto, precio: productoSeleccionado.precio });
            localStorage.setItem('carrito_ciarene', JSON.stringify(carrito));
            actualizarContador();
            cerrarModal();
            alert("Â¡AÃ±adido!");
        }

        function actualizarContador() { document.getElementById('cart-count').innerText = carrito.length; }

        window.onclick = (e) => { if(e.target.className == 'modal') cerrarModal(); }
        window.onload = cargarProductos;
    </script>
</body>
</html>
